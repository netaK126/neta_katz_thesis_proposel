%! Author = julianmour
%! Date = 01/05/2023

\section{Our Approach}

In this thesis, we will design an algorithm that would evaluate the affect of a perturbation on class confidence of two multi-label classifiers with the same architecture, for a given class $c'$. A naive algorithm simply encodes the two architectures into MILP verifier ~\cite{MIPVERIFY}. This shall be addressed as 'Base Approach'. Although this algorithm grantees accuracy, it is lack of scalability, and causes long execution times. Therefore, our goal is to enhance the scalability and cut the execution time. Our approach consists 3 main stages:
\begin{itemize}
    \item Encoding into MIP verifier the problem definition.
    \item Pruning the search space by computing dependencies stemming from the perturbation or the networks' computations
    \item Finding the upper and lower bounds using anytime optimization called Gurobi.
\end{itemize}
As shown in Preliminary Results section, our approach manages to significantly improve execution times while maintaining accuracy of the algorithm.

\subsection{Encoding The Problem Definition}
We encode the problem definition as a MIP problem and them we submit it to a MIP solver. The encoding includes each network's computation twice: for the class confidence of $x$ and for the class confidence of the perturbation $f_P(x,\epsilon)$. The computation is expressed as ~\cite{MIPVERIFY} proposes. Moreover we encode constraints $\phi_{dep}$ capturing dependencies over the networksâ€™ neurons (further described in~\ref{PRUNESUBSECTION}).
The encoding of the problem definition goes as follows:
$$max{\delta_{c'}} subject to:$$
$$ \epsilon'\in{I_\epsilon}; \phi_{dep}; \forall{F}\in{\{F_1,F_2\}}\forall{c''}\neq{c'}: z^{F}_{L,c'}-z^{F}_{L,c''}\geq\delta_{c'}; \forall{F}\in{\{F_1,F_2\}}\exists{c''}\neq{c'}: z^{F^p}_{L,c''}-z^{F^p}_{L,c'}>0$$
$$\forall{m,k}\forall{F}\in{\{F_1,F_2\}}: \hat{z}^F_{m,k}=b_{m,k}+\sum_{k'=1}^{k_{m-1}} w_{m,k,k'}\cdot{z^F_{m-1,k'}}; \hat{z}^{F^p}_{m,k}=b_{m,k}+\sum_{k'=1}^{k_{m-1}} w_{m,k,k'}\cdot{z^{F^p}_{m-1,k'}}$$
$$z^F_{m,k}\geq0; z^{F^p}_{m,k}\geq0; z^F_{m,k}\geq{\hat{z}^F_{m,k}}; z^{F^p}_{m,k}\geq{\hat{z}^{F^p}_{m,k}}$$
$$a^F_{m,k},a^{F^p}_{m,k}\in{\{0,1\}}: u^F_{m,k}\cdot{a^F_{m,k}}\geq{z^F_{m,k}}; u^{F^p}_{m,k}\cdot{a^{F^p}_{m,k}}\geq{z^{F^p}_{m,k}}$$



\subsection{Pruning the search space}\label{PRUNESUBSECTION}
???

\subsection{Anytime Optimizer}
To reduce the execution time of the algorithm, we employ anytime optimization technique using Gurobi. To find the optimal solution to our problem definition, Gurobi defines two bounds: an upper bound $\delta_u\geq\delta$ (initialized by a large value) and a lower bound $\delta\geq\delta_l$. It then iteratively decreases $\delta_u$ until reaching a value that violates the constraints of the optimization problem. For the lower bound, Gurobi looks for feasible solutions for the optimization problem. These parallel updated continue until $\delta_u=\delta_l$. At anytime we can terminate the process and detect $\delta\in[\delta_l,\delta_u]$. 